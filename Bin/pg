#!/bin/sh

# pg POSIX grep

invert=""
case=""
EXIT_CODE=1

while :; do
    case "$1" in
        -*) [ "${1}" = "-v" ] && invert=true
            [ "${1}" = "-i" ] && case=true
            ;;
        *)  match="${1}"; break ;;
    esac
    shift
done

found() {
    [ -z $invert ] && {
        printf "$@"
        EXIT_CODE=0
    }
}

not_found() {
    [ ! -z $invert ] && {
        printf "$@"
        EXIT_CODE=0
    }
}

while read -r line; do
    if [ -n "$case" ]; then
        testline=$(printf ${line} | tr '[:upper:]' '[:lower:]' )
        match=$(printf ${match} | tr '[:upper:]' '[:lower:]' )
    else
        testline=${line}
    fi
    case ${testline} in
        *${match}*) found '%s\n' "${line}" ;;
        *) not_found '%s\n' "${line}" ;;
    esac
done </dev/stdin

exit $EXIT_CODE
