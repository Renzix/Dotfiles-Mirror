#!/bin/sh

# Return if not interactive
[ -z "$PS1" ] && return

# Nice functions
# DEBUG=t
info() {
    [ -z "$DEBUG" ] ||
        printf "[%s]:$1\n" "$(date +'%D %T')";
    }
export PATH="$PATH:$HOME/.cargo/bin/:$HOME/.local/bin:$HOME/.go/bin"
export GOPATH="$HOME/.go"

isAvail() {
    COMMAND=$2
    NAME=$1
    shift; shift;
    if hash "${COMMAND}" 2>/dev/null; then
        info "${COMMAND} found making ${NAME} point to ${COMMAND} $@"
        alias ${NAME}="${COMMAND} $@"
    else
        return 1
    fi
}

isAvail ls exa
isAvail la exa -a
isAvail ll exa -lhF --color=always --time-style=full-iso
isAvail cat bat
isAvail find fd
isAvail e nvim
isAvail v nvim
isAvail vi nvim
isAvail vim nvim

# Some nice keybindings and aliases

alias sudo="sudo "
alias e="nvim"

# System Shutdown stuff
alias rb="sudo reboot"
alias sd="sudo shutdown -h now"

# git
alias gc="git commit"
alias gp="git push"

# Other
alias ht="htop"

# Helm like fzf
# @TODO(Renzix): Make this more helmlike and add toggles for input etc, multiple
# options with tabs and more keybinds. Also make it cancel correctly. Maybe add
# it into vim.

export FZF_FILES_ALL="false"

alias f=fzf-files
fzf-files() {
    mkdir -p /tmp/FZF_FILES
    SELECT=$( /bin/ls $@ | fzf \
              --bind "ctrl-h:execute(true > /tmp/FZF_FILES/ALL)+execute(true > /tmp/FZF_FILES/CHANGE)+abort" \
              --bind "ctrl-s:execute([ -f '/tmp/FZF_FILES/ALL' ] && rm /tmp/FZF_FILES/ALL)+execute(true > /tmp/FZF_FILES/CHANGE)+abort" )
    ARGS=""
    [ -f "/tmp/FZF_FILES/ALL" ] && ARGS+="-a"
    [ -z "$SELECT" ] && [ ! -f "/tmp/FZF_FILES/CHANGE" ] && return 0
    [ -z "$SELECT" ] && fzf-files $ARGS
    if [ -d "$SELECT" ]; then
        cd ${SELECT}
        fzf-files $ARGS
    elif [ -f "$SELECT" ]; then
        $EDITOR ${SELECT}
    fi
}

## im lazy xd ##
alias kill-skyrim="env WINEPREFIX=~/.local/share/Steam/steamapps/compatdata/72850/pfx wineserver -k"
alias kill-sse="env WINEPREFIX=~/.local/share/Steam/steamapps/compatdata/489830/pfx wineserver -k"
alias vortex="WINEPREFIX=\"$HOME/Games/vortex\" /home/genzix/.local/share/lutris/runners/wine/tkg-4.0-x86_64/bin/wine /home/genzix/Games/vortex/drive_c/Program\ Files/Black\ Tree\ Gaming\ Ltd/Vortex/Vortex.exe"
alias kill-vortex="WINEPREFIX=\"$HOME/Games/vortex\" wineserver -k"

# Check the shell and run shell specific commands there
# note that some of this isnt posix but it is "posix" for
# the shell specified
if [ -n "$BASH_VERSION" ]; then 
    info "Your using bash"
    . "$HOME/Dotfiles/.bashrc"
elif [ -n "$ZSH_VERSION" ]; then
    info "Your using zsh"
    . "$HOME/Dotfiles/.zshrc"
else
    info "Finish shellrc"
    export PS1="\$ "
fi

export NIX_AUTO_RUN=1
